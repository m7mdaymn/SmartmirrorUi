<div class="room-page">
  <!-- Back Button with Disable Logic -->
  <button
    class="back-btn"
    (click)="onBackClick()"
    [disabled]="isDisabling"
    [class.disabling]="isDisabling">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M19 12H5M12 19l-7-7 7-7"/>
    </svg>
    <span *ngIf="isDisabling" class="disabling-text">Disabling...</span>
  </button>

  <!-- Header -->
  <div class="page-header">
    <div class="title-section">
      <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
        <polyline points="9 22 9 12 15 12 15 22"/>
      </svg>
      <div class="title-text">
        <h1>Room Environment</h1>
        <p class="subtitle">Live data from DHT22 sensor</p>
      </div>
    </div>

    <div class="room-info">
      <div class="room-name">Living Room</div>
      <div class="room-status" [class]="connectionStatus">
        <div class="status-dot"></div>
        <span>{{ connectionStatusText }}</span>
        <small *ngIf="lastUpdated">Updated: {{ lastUpdated }}</small>
      </div>
    </div>
  </div>

  <!-- Loading State with Progress -->
  <div class="loading-overlay" *ngIf="loading">
    <div class="loading-content">
      <div class="loading-spinner">
        <svg width="80" height="80" viewBox="0 0 80 80">
          <circle cx="40" cy="40" r="35" fill="none" stroke="rgba(100, 200, 255, 0.2)" stroke-width="6"/>
          <circle
            cx="40"
            cy="40"
            r="35"
            fill="none"
            stroke="#64c8ff"
            stroke-width="6"
            stroke-dasharray="220"
            [attr.stroke-dashoffset]="220 - (220 * loadingProgress / 100)"
            class="progress-circle"/>
        </svg>
        <div class="progress-percentage">{{ loadingProgress | number:'1.0-0' }}%</div>
      </div>
      <p class="loading-message">{{ loadingMessage }}</p>
      <div class="loading-bar-container">
        <div class="loading-bar" [style.width.%]="loadingProgress"></div>
      </div>
    </div>
  </div>

  <!-- Error State -->
  <div class="error-message" *ngIf="error && !loading">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="12" cy="12" r="10"/>
      <line x1="12" y1="8" x2="12" y2="12"/>
      <line x1="12" y1="16" x2="12.01" y2="16"/>
    </svg>
    <div>
      <p>{{ error }}</p>
      <p>Make sure the DHT22 sensor is enabled from the home screen.</p>
    </div>
  </div>

  <!-- Main Data -->
  <div class="dashboard" *ngIf="latestReading && !loading && !error">
    <!-- Temperature Card -->
    <div class="sensor-card temperature">
      <div class="sensor-header">
        <div class="sensor-icon">ğŸŒ¡ï¸</div>
        <h3>Temperature</h3>
      </div>
      <div class="sensor-value">
        <div class="current-value">{{ temperature }}<span class="unit">Â°{{ unit }}</span></div>
      </div>
      <div class="sensor-range">
        <div class="range-bar">
          <div class="range-fill" [style.width.%]="tempPercentage"></div>
          <div class="range-indicator" [style.left.%]="tempPercentage"></div>
        </div>
        <div class="range-labels">
          <span>16Â°</span>
          <span class="comfort-range">18â€“26Â°C</span>
          <span>30Â°</span>
        </div>
      </div>
    </div>

    <!-- Humidity Card -->
    <div class="sensor-card humidity">
      <div class="sensor-header">
        <div class="sensor-icon">ğŸ’§</div>
        <h3>Humidity</h3>
      </div>
      <div class="sensor-value">
        <div class="current-value">{{ humidity }}<span class="unit">%</span></div>
      </div>
      <div class="sensor-range">
        <div class="range-bar">
          <div class="range-fill" [style.width.%]="humidityPercentage"></div>
          <div class="range-indicator" [style.left.%]="humidityPercentage"></div>
        </div>
        <div class="range-labels">
          <span>30%</span>
          <span class="comfort-range">40â€“60%</span>
          <span>80%</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Environmental Analysis -->
  <div class="analysis-section" *ngIf="latestReading && !loading">
    <h2>Environmental Analysis</h2>

    <div class="analysis-grid">
      <!-- Comfort Score Card -->
      <div class="analysis-card comfort-card" [attr.data-level]="comfortLevel">
        <div class="card-header">
          <div class="icon-wrapper">
            <span class="emoji">{{ comfortLevel === 'Very Comfortable' ? 'ğŸ˜Š' : comfortLevel === 'Comfortable' ? 'ğŸ™‚' : 'ğŸ˜•' }}</span>
          </div>
          <div class="header-text">
            <h3>Comfort Score</h3>
            <p class="status-label" [style.color]="comfortColor">{{ comfortLevel }}</p>
          </div>
        </div>
        <div class="score-visual">
          <svg width="100" height="100" viewBox="0 0 100 100">
            <circle cx="50" cy="50" r="45" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="8"/>
            <circle
              cx="50"
              cy="50"
              r="45"
              fill="none"
              [attr.stroke]="comfortColor"
              stroke-width="8"
              stroke-dasharray="283"
              [attr.stroke-dashoffset]="283 - (283 * comfortScore / 100)"
              class="score-circle"/>
          </svg>
          <div class="score-number" [style.color]="comfortColor">{{ comfortScore }}</div>
        </div>
      </div>

      <!-- Air Quality Indicator -->
      <div class="analysis-card air-quality-card">
        <div class="card-header">
          <div class="icon-wrapper">
            <span class="emoji">ğŸ’¨</span>
          </div>
          <div class="header-text">
            <h3>Air Quality</h3>
            <p class="status-label">{{ airQualityStatus }}</p>
          </div>
        </div>
        <div class="quality-bars">
          <div class="quality-item">
            <span>Humidity</span>
            <div class="bar-container">
              <div class="bar" [style.width.%]="humidity" [style.background]="getHumidityColor()"></div>
            </div>
          </div>
          <div class="quality-item">
            <span>Temperature</span>
            <div class="bar-container">
              <div class="bar" [style.width.%]="tempPercentage" [style.background]="getTempColor()"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Recommendations Card -->
      <div class="analysis-card recommendations-card">
        <div class="card-header">
          <div class="icon-wrapper">
            <span class="emoji">ğŸ’¡</span>
          </div>
          <div class="header-text">
            <h3>Recommendations</h3>
          </div>
        </div>
        <div class="recommendations-list">
          <div class="recommendation" *ngFor="let rec of recommendations">
            <span class="rec-icon">{{ rec.icon }}</span>
            <span class="rec-text">{{ rec.text }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
